# ðŸ“¦ Project Structure

A well-defined project structure is critical for a hybrid Rust/TypeScript project. Our structure is based on best practices from projects like Signal, 1Password, and Figma, utilizing a pnpm-based monorepo.

```
construct-messenger/
â”œâ”€â”€ Cargo.toml                    # Root workspace
â”œâ”€â”€ package.json                  # Root package.json
â”œâ”€â”€ pnpm-workspace.yaml           # Monorepo definition
â”œâ”€â”€ .cargo/config.toml            # Cargo settings for WASM
â”œâ”€â”€ .github/workflows/            # CI/CD pipelines
â”‚
â”œâ”€â”€ apps/                         # End-user applications
â”‚   â”œâ”€â”€ pwa/                      # The SvelteKit PWA
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ components/   # UI-only components
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ styles/
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/           # SvelteKit pages
â”‚   â”‚   â””â”€â”€ package.json          # Depends on @construct/core
â”‚   â””â”€â”€ ...                       # Future desktop/mobile apps
â”‚
â”œâ”€â”€ packages/                     # Reusable libraries
â”‚   â”œâ”€â”€ core/                     # THE CORE: Rust + WASM + TS wrappers
â”‚   â”‚   â”œâ”€â”€ Cargo.toml            # The main Rust crate
â”‚   â”‚   â”œâ”€â”€ package.json          # The npm package @construct/core
â”‚   â”‚   â”œâ”€â”€ src/                  # Rust source code
â”‚   â”‚   â”‚   â”œâ”€â”€ lib.rs            # WASM exports
â”‚   â”‚   â”‚   â”œâ”€â”€ api/              # Public Rust API
â”‚   â”‚   â”‚   â”œâ”€â”€ crypto/           # Cryptography
â”‚   â”‚   â”‚   â”œâ”€â”€ protocol/         # Network protocols
â”‚   â”‚   â”‚   â”œâ”€â”€ storage/          # Storage interfaces
â”‚   â”‚   â”‚   â”œâ”€â”€ state/            # State management
â”‚   â”‚   â”‚   â””â”€â”€ wasm/             # WASM-specific helpers
â”‚   â”‚   â”œâ”€â”€ tests/                # Rust tests
â”‚   â”‚   â”œâ”€â”€ benches/              # Benchmarks
â”‚   â”‚   â””â”€â”€ bindings/             # Autogenerated TS bindings
â”‚   â”‚
â”‚   â””â”€â”€ ...                       # Other shared packages
â”‚
â”œâ”€â”€ crates/                       # Helper Rust libraries
â”‚   â”œâ”€â”€ crypto-utils/             # Crypto utilities
â”‚   â””â”€â”€ ...                       # Other internal crates
â”‚
â”œâ”€â”€ scripts/                      # Build and utility scripts
â”‚   â”œâ”€â”€ build-wasm.js
â”‚   â””â”€â”€ generate-bindings.js
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ architecture/
    â”œâ”€â”€ api/
    â””â”€â”€ security/
```

## ðŸŽ¯ Core Structure (`packages/core`)

This is the heart of the application.

```
packages/core/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ lib.rs                    # Root module and wasm_bindgen exports
â”‚   â”œâ”€â”€ api/                      # Public API exposed to TypeScript
â”‚   â”‚   â”œâ”€â”€ messaging.rs
â”‚   â”‚   â”œâ”€â”€ contacts.rs
â”‚   â”‚   â””â”€â”€ crypto.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ crypto/                   # Internal cryptographic implementation
â”‚   â”‚   â”œâ”€â”€ x3dh.rs
â”‚   â”‚   â”œâ”€â”€ ratchet.rs
â”‚   â”‚   â””â”€â”€ session.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ protocol/                 # Network protocol logic
â”‚   â”‚   â”œâ”€â”€ wire.rs               # Wire format (MessagePack)
â”‚   â”‚   â””â”€â”€ transport.rs          # WebSocket transport
â”‚   â”‚
â”‚   â”œâ”€â”€ storage/                  # Storage abstractions
â”‚   â”‚   â”œâ”€â”€ indexeddb.rs          # Browser implementation
â”‚   â”‚   â””â”€â”€ memory.rs             # In-memory for tests
â”‚   â”‚
â”‚   â”œâ”€â”€ state/                    # Application state management
â”‚   â”‚   â”œâ”€â”€ app.rs                # Main state machine
â”‚   â”‚   â””â”€â”€ conversations.rs
â”‚   â”‚
â”‚   â”œâ”€â”€ wasm/                     # WASM-specific code (e.g., panic hooks)
â”‚   â”‚
â”‚   â””â”€â”€ utils/                    # Common utilities
â”‚       â”œâ”€â”€ error.rs
â”‚       â””â”€â”€ time.rs
â”‚
â””â”€â”€ bindings/                     # Autogenerated TypeScript bindings
    â”œâ”€â”€ index.ts                  # Main export
    â””â”€â”€ types.ts                  # TypeScript types
```

This structure provides a clear separation between the public API (`src/api/`) and the internal implementation details, making the codebase easier to navigate, test, and maintain.
